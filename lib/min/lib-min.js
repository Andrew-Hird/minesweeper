function initBoard(){if(!tests.boardValid()||!tests.cellsValid())return null;displayMessage("Let's play!"),board.cells.sort(cellCompare);var e=document.getElementsByClassName("board")[0];return drawBoard(e),addListeners(e),!0}function drawBoard(e){e.style.width=85*Math.sqrt(board.cells.length)+"px",board.cells.reduce(cellsToNodes,e)}function cellCompare(e,n){return e.row<n.row?-1:e.row>n.row?1:e.col<n.col?-1:e.col>n.col?1:0}function cellsToNodes(e,n){var r=document.createElement("div");return r.classList.add("row-"+n.row),r.classList.add("col-"+n.col),n.isMine&&r.classList.add("mine"),n.hidden?r.classList.add("hidden"):n.surroundingMines&&!n.isMine&&(r.innerHTML=n.surroundingMines),e.appendChild(r),e}function addListeners(e){for(var n=0;n<e.children.length;n++)e.children[n].addEventListener("click",showCell),e.children[n].addEventListener("contextmenu",markCell)}function showCell(e){var n=getCellIndex(getRow(e.target),getCol(e.target)),r=board.cells[n];return r.hidden=!1,r.isMarked=!1,e.target.classList.remove("hidden"),e.target.classList.remove("marked"),e.target.classList.contains("mine")?(displayMessage('BOOM! <br> <button onClick="history.go(0)">Play Again?</button>'),revealMines(),void removeListeners()):(setInnerHTML(r),void(0===r.surroundingMines&&showSurrounding(e.target)))}function markCell(e){e.preventDefault(),e.target.classList.toggle("marked");var n=getCellIndex(getRow(e.target),getCol(e.target)),r=board.cells[n];r.isMarked=r.isMarked?!1:!0}function getSurroundingCells(e,n){var r=getRange(getLowerBound(n),getUpperBound(n)),t=getRange(getLowerBound(e),getUpperBound(e));return board.cells.filter(function(e){return r.includes(e.col)&&t.includes(e.row)})}function showSurrounding(e){getSurroundingCells(getRow(e),getCol(e)).filter(function(e){return!e.isMine&&!e.isMarked}).filter(function(e){return!e.isProcessed}).forEach(setInnerHTML)}function setInnerHTML(e){e.isProcessed=!0;var n=getNodeByCoordinates(e.row,e.col);if(""===n.innerHTML)return n.innerHTML=e.surroundingMines>0?e.surroundingMines:"",n.classList.contains("hidden")&&(e.hidden=!1,n.classList.remove("hidden"),0===e.surroundingMines)?showSurrounding(n):void 0}function getRange(e,n){return Array.apply(e,Array(n-e+1)).map(function(n,r){return e+r})}function getLowerBound(e){return 0>e-1?0:e-1}function getUpperBound(e){var n=Math.sqrt(board.cells.length);return e+1>n?n:e+1}function displayMessage(e){document.getElementById("message").innerHTML="<p>"+e+"</p>"}function getRow(e){return parseInt(getCoordinate(e,"row"),10)}function getCol(e){return parseInt(getCoordinate(e,"col"),10)}function getCoordinate(e,n){return makeArray(e.classList).find(function(e){return e.substring(0,n.length)===n}).split("-")[1]}function revealMines(){makeArray(document.getElementsByClassName("mine")).forEach(function(e){e.classList.remove("hidden"),e.classList.remove("marked")})}function removeListeners(){var e=document.getElementsByClassName("board")[0],n=e.cloneNode(!0);e.parentNode.replaceChild(n,e)}function makeArray(e){return[].slice.call(e)}function getCellIndex(e,n){var r=null;return board.cells.find(function(t,o){return t.row===e&&t.col===n?(r=o,!0):void 0}),r}function getNodeByCoordinates(e,n){var r="row-"+e,t="col-"+n;return document.getElementsByClassName(r+" "+t)[0]}var lib={initBoard:initBoard,displayMessage:displayMessage,getSurroundingCells:getSurroundingCells};Array.prototype.includes||(Array.prototype.includes=function(e){"use strict";var n=Object(this),r=parseInt(n.length,10)||0;if(0===r)return!1;var t=parseInt(arguments[1],10)||0,o;t>=0?o=t:(o=r+t,0>o&&(o=0));for(var s;r>o;){if(s=n[o],e===s)return!0;o++}return!1});